image: python:3.10-slim

stages:
  - build
  - lint
  - test

cache:
  paths:
    - .pip-cache/

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.pip-cache"

setup_environment:
  stage: build
  script:
    - echo "Iniciando instalaci√≥n..."
    - python -m pip install --upgrade pip
    - pip install -r requirements.txt
  artifacts:
    paths:
      - .pip-cache/

check_quality:
  stage: lint
  script:
    - pip install flake8
    - flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
  dependencies:
    - setup_environment

run_tests:
  stage: test
  script:
    - pip install -r requirements.txt
    - pip install pytest
    - pytest test/  
  dependencies:
    - setup_environment